var form;function setDisabledStatusInSection(section,status){for(var form_elements=section.querySelectorAll("input, select, button"),i=0,imax=form_elements.length;i<imax;++i)form_elements[i].disabled=status}function validateForm(form_elements){let validaiton=!0,validators={zip_code:{regexp:/^\d{2}-\d{3}$/,errorText:"Błędny kod pocztowy"},phone_start:{regexp:/^(\+\d{2})?$/,errorText:"Błędny numer kierunkowy"},phone:{regexp:/^\d{9}$/,errorText:"Błędny numer telefonu"},email:{regexp:/^[a-zA-Z0-9.!#$%&’*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/,errorText:"Nieprawidłowy email"},person_id:{regexp:/^\d{11}$/,errorText:"Błędny pesel"},company_id:{regexp:/^\d{10}$/,errorText:"Błędny nip"}},form_el,form_value,validator;for(let i=0,imax=form_elements.length;i<imax;++i){switch(form_el=form_elements[i],form_el.nodeName){case"INPUT":case"SELECT":break;default:continue}form_el.disabled||(form_value=form_el.value,""!=form_value.trim()?(validator=validators[form_el.name],null==validator||form_value.match(validator.regexp)?addErrorToFormSection(form_el,""):(addErrorToFormSection(form_el,validator.errorText),validaiton=!1)):(addErrorToFormSection(form_el,"Pole nie może być puste"),validaiton=!1))}return validaiton}function setupFields(value){let classes=["only-for-person","only-for-company"],cls_index_to_show,cls_index_to_hide;switch(value){case"company":cls_index_to_show=1,cls_index_to_hide=0;break;case"person":cls_index_to_show=0,cls_index_to_hide=1;break;default:return}let to_show=document.getElementsByClassName(classes[cls_index_to_show]),to_hide=document.getElementsByClassName(classes[cls_index_to_hide]),i;for(i=0,imax=to_show.length;i<imax;++i)to_show[i].style.display="",setDisabledStatusInSection(to_show[i],!1);for(i=0,imax=to_hide.length;i<imax;++i)to_hide[i].style.display="none",setDisabledStatusInSection(to_hide[i],!0)}function setupRadio(){let radio_inputs=document.getElementsByClassName("law-status-radio"),radio;for(var i=0,imax=radio_inputs.length;i<imax;++i)radio=radio_inputs[i],radio.checked&&setupFields(radio.value),radio.addEventListener("change",(function(){setupFields(this.value)}))}function setupSelect(){let xhr=new XMLHttpRequest;xhr.open("get","/api/regions"),xhr.addEventListener("load",ev=>{let data=JSON.parse(ev.target.responseText),select=document.getElementById("select-region"),selected=select.getAttribute("data-val"),option;data.forEach(value=>{option=document.createElement("option"),option.value=value,option.textContent=value,selected==value&&(option.selected=!0),select.appendChild(option)})}),xhr.send()}function setupForm(){form.addEventListener("submit",(function(ev){ev.preventDefault();let form_elements=this.elements;if(validateForm(form_elements)){let formdata=new FormData(form),xhr=new XMLHttpRequest;xhr.open(this.method,this.action),xhr.setRequestHeader("X-CSRF-TOKEN",form_elements._token.value),xhr.addEventListener("load",(function(){let res=JSON.parse(this.responseText);if(res.success)window.location="/client/"+res.id;else for(i=0;i<form_elements.length;++i)addErrorToFormSection(form_elements[i],null!=res.errors[form_elements[i].name]?res.errors[form_elements[i].name]:"")})),xhr.send(formdata)}return!1}),!1)}function addErrorToFormSection(formElement,error){let name=formElement.name+"-error",container=formElement.parentElement.parentElement,errorContainer=document.getElementById(name);if(null==errorContainer){if(""==error)return;errorContainer=document.createElement("div"),errorContainer.id=name,errorContainer.className="error",errorContainer.textContent=error,container.appendChild(errorContainer)}else""==error?container.removeChild(errorContainer):errorContainer.textContent=error}document.addEventListener("DOMContentLoaded",()=>{form=document.getElementById("form-client"),setupRadio(),setupSelect(),setupForm(),form.querySelector(".cancel-form").addEventListener("click",(function(){form.reset(),setupFields(form.law_status.value)}),!1)},!1);